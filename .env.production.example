# =============================================================================
# Production Environment Configuration
# =============================================================================
# This file is a template for production deployment with Infisical
# Copy this file to .env.production and fill in the actual values
#
# IMPORTANT: Never commit .env.production to git!
# =============================================================================

# =============================================================================
# Infisical Secrets Management (PRODUCTION)
# =============================================================================
# Enable Infisical for production secrets management
USE_INFISICAL=true

# Infisical Self-Hosted Instance URL
INFISICAL_SITE_URL=https://infisical.ajianaz.dev

# Universal Auth (Machine Identity) Credentials
# Create these in Infisical UI: Settings > Machine Identities
# IMPORTANT: Use production-specific machine identity
INFISICAL_CLIENT_ID=your-production-client-id-here
INFISICAL_CLIENT_SECRET=your-production-client-secret-here

# Project ID from Infisical
# Use the production project ID
INFISICAL_PROJECT_ID=your-production-project-id-here

# Environment (must be 'prod' or 'production')
INFISICAL_ENVIRONMENT=prod

# Cache TTL (5 minutes recommended for production)
INFISICAL_CACHE_TTL=300000

# =============================================================================
# Application Configuration
# =============================================================================
NODE_ENV=production
PORT=3000

# =============================================================================
# Service Connection Configuration
# =============================================================================
# NOTE: Only host/port configuration needed
# Secrets (passwords, keys) will be fetched from Infisical

# PostgreSQL Service Configuration
POSTGRES_DB=modular_monolith
POSTGRES_USER=postgres
# POSTGRES_PASSWORD will be fetched from Infisical
POSTGRES_PORT=5432

# Redis Service Configuration
# REDIS_PASSWORD will be fetched from Infisical
REDIS_PORT=6379

# =============================================================================
# Application URLs
# =============================================================================
# Better Auth URL (update with production domain)
BETTER_AUTH_URL=https://api.yourdomain.com/api/auth

# =============================================================================
# Keycloak OIDC Provider Configuration
# =============================================================================
# Update these with your production Keycloak instance
KEYCLOAK_URL=https://keycloak.yourdomain.com
KEYCLOAK_REALM=production
KEYCLOAK_ISSUER=https://keycloak.yourdomain.com/realms/production
KEYCLOAK_CLIENT_ID=modular-monolith-api
# KEYCLOAK_CLIENT_SECRET will be fetched from Infisical

# =============================================================================
# Feature Flags
# =============================================================================
ENABLE_RS256_TOKENS=true
ENABLE_KEYCLOAK=true

# =============================================================================
# FALLBACK SECRETS (EMERGENCY USE ONLY)
# =============================================================================
# WARNING: These values are ONLY used if:
# 1. Infisical is disabled (USE_INFISICAL=false)
# 2. Infisical is unreachable
# 3. Secret not found in Infisical
#
# For production, these should be left empty or contain dummy values
# All real secrets MUST be in Infisical
#
# If you must use fallbacks temporarily, rotate them immediately!
# =============================================================================

# Database Fallback
POSTGRES_PASSWORD=

# Redis Fallback
REDIS_PASSWORD=

# Better Auth Fallback
BETTER_AUTH_SECRET=

# Keycloak Fallback
KEYCLOAK_CLIENT_SECRET=

# JWT Fallback
JWT_SECRET=

# =============================================================================
# Deployment Notes
# =============================================================================
# 1. Before deploying to production:
#    - Create Machine Identity in Infisical (production environment)
#    - Import all secrets to Infisical (prod environment)
#    - Verify all secrets exist in Infisical
#    - Test with USE_INFISICAL=true in staging first
#
# 2. Deployment command:
#    docker-compose --env-file .env.production up -d
#
# 3. Verify Infisical connection:
#    docker-compose logs api | grep INFISICAL
#    Expected: "[INFISICAL] âœ… Successfully initialized"
#
# 4. Monitor secrets:
#    - Check Infisical audit logs regularly
#    - Set up alerts for secret access
#    - Rotate secrets according to security policy
# =============================================================================
